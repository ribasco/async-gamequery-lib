<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.11.1 from site/markdown/examples/source_query_example.md at 2024-03-01
 | Rendered using Apache Maven Fluido Skin 1.10.0
-->
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="generator" content="Apache Maven Doxia Site Renderer 1.11.1" />
    <title>Asynchronous Game Query Library &#x2013; Source Server Queries</title>
    <link rel="stylesheet" href="../css/apache-maven-fluido-1.10.0.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />
    <script src="../js/apache-maven-fluido-1.10.0.min.js"></script>

  </head>
  <body class="topBarEnabled">
    <a href="https://github.com/ribasco/async-gamequery-lib">
      <img style="position: absolute; top: 0; right: 0; border: 0; z-index: 10000;"
        src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png"
        alt="Fork me on GitHub">
    </a>
    <header id="topbar" class="navbar navbar-fixed-top ">
      <div class="navbar-inner">
        <div class="container-fluid">
        <a data-target=".nav-collapse" data-toggle="collapse" class="btn btn-navbar">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </a>
            <ul class="nav">
      <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Overview <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="../introduction.html" title="Introduction">Introduction</a></li>
            <li><a href="../configuration.html" title="Configuration">Configuration</a></li>
            <li><a href="../apidocs/" title="Java Docs">Java Docs</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Examples <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="../examples/webapi_general_usage.html" title="General Web API Usage">General Web API Usage</a></li>
            <li><a href="../examples/master_query_example.html" title="Master Server Query">Master Server Query</a></li>
            <li><a href="../examples/source_query_example.html" title="Source Server Queries">Source Server Queries</a></li>
            <li><a href="../examples/source_rcon_example.html" title="Source RCON">Source RCON</a></li>
            <li><a href="../examples/source_log_example.html" title="Source Log Listener">Source Log Listener</a></li>
            <li><a href="../examples/webapi_coc_example.html" title="Clash of Clans Web API">Clash of Clans Web API</a></li>
            <li><a href="../examples/webapi_csgo_example.html" title="CS:GO Web API">CS:GO Web API</a></li>
            <li><a href="../examples/webapi_dota2_example.html" title="Dota 2 Web API">Dota 2 Web API</a></li>
            <li><a href="../examples/webapi_steam_example.html" title="Steam Web API">Steam Web API</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Modules <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="../agql-lib-core/index.html" title="AGQL - Core">AGQL - Core</a></li>
            <li><a href="../agql-lib-examples/index.html" title="AGQL - Examples">AGQL - Examples</a></li>
            <li><a href="../protocols/supercell/clashofclans/agql-coc-webapi/index.html" title="AGQL - Supercell - COC WebAPI">AGQL - Supercell - COC WebAPI</a></li>
            <li><a href="../protocols/valve/source/agql-source-query/index.html" title="AGQL - Valve - Source Query">AGQL - Valve - Source Query</a></li>
            <li><a href="../protocols/valve/source/agql-source-rcon/index.html" title="AGQL - Valve - Source RCON">AGQL - Valve - Source RCON</a></li>
            <li><a href="../protocols/valve/source/agql-source-log/index.html" title="AGQL - Valve - Source Logging Service">AGQL - Valve - Source Logging Service</a></li>
            <li><a href="../protocols/supercell/clashofclans/agql-csgo-webapi/index.html" title="AGQL - Valve - CS:GO WebAPI">AGQL - Valve - CS:GO WebAPI</a></li>
            <li><a href="../protocols/supercell/clashofclans/agql-dota2-webapi/index.html" title="AGQL - Valve - Dota 2 WebAPI">AGQL - Valve - Dota 2 WebAPI</a></li>
            <li><a href="../protocols/valve/steam/agql-steam-master/index.html" title="AGQL - Valve - Steam Master Query">AGQL - Valve - Steam Master Query</a></li>
            <li><a href="../protocols/supercell/clashofclans/agql-steam-webapi/index.html" title="AGQL - Valve - Steam Web API">AGQL - Valve - Steam Web API</a></li>
            <li><a href="../agql/index.html" title="AGQL - Aggregate">AGQL - Aggregate</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Project Documentation <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li class="dropdown-submenu">
<a href="../project-info.html" title="Project Information">Project Information</a>
              <ul class="dropdown-menu">
                  <li><a href="../ci-management.html" title="CI Management">CI Management</a></li>
                  <li><a href="../dependency-convergence.html" title="Dependency Convergence">Dependency Convergence</a></li>
                  <li><a href="../dependency-info.html" title="Dependency Information">Dependency Information</a></li>
                  <li><a href="../dependency-management.html" title="Dependency Management">Dependency Management</a></li>
                  <li><a href="../distribution-management.html" title="Distribution Management">Distribution Management</a></li>
                  <li><a href="../index.html" title="About">About</a></li>
                  <li><a href="../issue-management.html" title="Issue Management">Issue Management</a></li>
                  <li><a href="../licenses.html" title="Licenses">Licenses</a></li>
                  <li><a href="../mailing-lists.html" title="Mailing Lists">Mailing Lists</a></li>
                  <li><a href="../modules.html" title="Project Modules">Project Modules</a></li>
                  <li><a href="../plugin-management.html" title="Plugin Management">Plugin Management</a></li>
                  <li><a href="../plugins.html" title="Plugins">Plugins</a></li>
                  <li><a href="../scm.html" title="Source Code Management">Source Code Management</a></li>
                  <li><a href="../summary.html" title="Summary">Summary</a></li>
                  <li><a href="../team.html" title="Team">Team</a></li>
              </ul>
            </li>
            <li class="dropdown-submenu">
<a href="../project-reports.html" title="Project Reports">Project Reports</a>
              <ul class="dropdown-menu">
                  <li><a href="../changelog.html" title="Change Log">Change Log</a></li>
                  <li><a href="../file-activity.html" title="File Activity">File Activity</a></li>
                  <li><a href="../dev-activity.html" title="Developer Activity">Developer Activity</a></li>
                  <li><a href="../apidocs/index.html" title="Javadoc">Javadoc</a></li>
              </ul>
            </li>
        </ul>
      </li>
            </ul>
        </div>
      </div>
    </header>
    <div class="container-fluid">
      <header>
        <div id="banner">
          <div class="pull-left"><a href=".././" id="bannerLeft"><img src="../images/agql-banner-left-simple.png"  alt="Asynchronous Game Query Library"/></a></div>
          <div class="pull-right"></div>
          <div class="clear"><hr/></div>
        </div>

        <div id="breadcrumbs">
          <ul class="breadcrumb">
        <li id="publishDate">Last Published: 2024-03-01</li>
      <li id="projectVersion" class="pull-right">Version: 1.2.2</li>
          </ul>
        </div>
      </header>
      <div class="row-fluid">
        <header id="leftColumn" class="span2">
          <nav class="well sidebar-nav">
  <ul class="nav nav-list">
   <li class="nav-header">Overview</li>
    <li><a href="../introduction.html" title="Introduction"><span class="none"></span>Introduction</a></li>
    <li><a href="../configuration.html" title="Configuration"><span class="none"></span>Configuration</a></li>
    <li><a href="../apidocs/" title="Java Docs"><span class="none"></span>Java Docs</a></li>
   <li class="nav-header">Examples</li>
    <li><a href="../examples/webapi_general_usage.html" title="General Web API Usage"><span class="none"></span>General Web API Usage</a></li>
    <li><a href="../examples/master_query_example.html" title="Master Server Query"><span class="none"></span>Master Server Query</a></li>
    <li class="active"><a href="#"><span class="none"></span>Source Server Queries</a></li>
    <li><a href="../examples/source_rcon_example.html" title="Source RCON"><span class="none"></span>Source RCON</a></li>
    <li><a href="../examples/source_log_example.html" title="Source Log Listener"><span class="none"></span>Source Log Listener</a></li>
    <li><a href="../examples/webapi_coc_example.html" title="Clash of Clans Web API"><span class="none"></span>Clash of Clans Web API</a></li>
    <li><a href="../examples/webapi_csgo_example.html" title="CS:GO Web API"><span class="none"></span>CS:GO Web API</a></li>
    <li><a href="../examples/webapi_dota2_example.html" title="Dota 2 Web API"><span class="none"></span>Dota 2 Web API</a></li>
    <li><a href="../examples/webapi_steam_example.html" title="Steam Web API"><span class="none"></span>Steam Web API</a></li>
   <li class="nav-header">Modules</li>
    <li><a href="../agql-lib-core/index.html" title="AGQL - Core"><span class="none"></span>AGQL - Core</a></li>
    <li><a href="../agql-lib-examples/index.html" title="AGQL - Examples"><span class="none"></span>AGQL - Examples</a></li>
    <li><a href="../protocols/supercell/clashofclans/agql-coc-webapi/index.html" title="AGQL - Supercell - COC WebAPI"><span class="none"></span>AGQL - Supercell - COC WebAPI</a></li>
    <li><a href="../protocols/valve/source/agql-source-query/index.html" title="AGQL - Valve - Source Query"><span class="none"></span>AGQL - Valve - Source Query</a></li>
    <li><a href="../protocols/valve/source/agql-source-rcon/index.html" title="AGQL - Valve - Source RCON"><span class="none"></span>AGQL - Valve - Source RCON</a></li>
    <li><a href="../protocols/valve/source/agql-source-log/index.html" title="AGQL - Valve - Source Logging Service"><span class="none"></span>AGQL - Valve - Source Logging Service</a></li>
    <li><a href="../protocols/supercell/clashofclans/agql-csgo-webapi/index.html" title="AGQL - Valve - CS:GO WebAPI"><span class="none"></span>AGQL - Valve - CS:GO WebAPI</a></li>
    <li><a href="../protocols/supercell/clashofclans/agql-dota2-webapi/index.html" title="AGQL - Valve - Dota 2 WebAPI"><span class="none"></span>AGQL - Valve - Dota 2 WebAPI</a></li>
    <li><a href="../protocols/valve/steam/agql-steam-master/index.html" title="AGQL - Valve - Steam Master Query"><span class="none"></span>AGQL - Valve - Steam Master Query</a></li>
    <li><a href="../protocols/supercell/clashofclans/agql-steam-webapi/index.html" title="AGQL - Valve - Steam Web API"><span class="none"></span>AGQL - Valve - Steam Web API</a></li>
    <li><a href="../agql/index.html" title="AGQL - Aggregate"><span class="none"></span>AGQL - Aggregate</a></li>
   <li class="nav-header">Project Documentation</li>
    <li><a href="../project-info.html" title="Project Information"><span class="icon-chevron-right"></span>Project Information</a></li>
    <li><a href="../project-reports.html" title="Project Reports"><span class="icon-chevron-right"></span>Project Reports</a></li>
  </ul>
          </nav>
          <div class="well sidebar-nav">
            <hr />
            <div id="poweredBy">
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
<a href="http://maven.apache.org/" title="Maven" class="builtBy"><img class="builtBy"  alt="Maven" src="http://maven.apache.org/images/logos/maven-feather.png"    /></a>
<a href="http://www.ej-technologies.com/products/jprofiler/overview.html" title="JProfiler" class="builtBy"><img class="builtBy"  alt="JProfiler" src="https://www.ej-technologies.com/images/product_banners/jprofiler_small.png"    /></a>
            </div>
          </div>
        </header>
        <main id="bodyColumn"  class="span10" >
<section>
<h2><a name="Source_Server_Queries"></a>Source Server Queries</h2>
<ol style="list-style-type: decimal">

<li><a href="#supported-queries">Supported Queries</a></li>
<li><a href="#supported-failsafe-policies">Supported Failsafe Policies</a></li>
<li><a href="#examples">Examples</a>
<ol style="list-style-type: decimal">

<li><a href="#non-blocking-example">Non-Blocking Queries</a></li>
<li><a href="#blocking-example">Blocking Queries</a></li>
<li><a href="#obtaining-a-challenge-number-manually">Manually obtaining a challenge number</a></li>
<li><a href="#rate-limited-queries">Failsafe - Rate limited queries</a></li>
</ol>
</li>
</ol><section><section>
<h4><a name="Supported_Queries"></a>Supported Queries</h4>
<p>Below are the list of supported server queries</p>
<table border="0" class="table table-striped">
<thead>

<tr class="a">
<th>Name</th>
<th>Description</th>
<th>Protocol</th>
<th align="left">Requires Challenge</th></tr>
</thead><tbody>

<tr class="b">
<td align="left">Info</td>
<td>General information about the source server (Now supports challenge based requests)</td>
<td><a class="externalLink" href="https://developer.valvesoftware.com/wiki/Server_queries#A2S_INFO">A2S_INFO</a></td>
<td align="left">No</td></tr>
<tr class="a">
<td align="left">Players</td>
<td>Information about the players currently present in the source server</td>
<td><a class="externalLink" href="https://developer.valvesoftware.com/wiki/Server_queries#A2S_PLAYER">A2S_PLAYER</a></td>
<td align="left">Yes</td></tr>
<tr class="b">
<td align="left">Rules</td>
<td>A list of rules specified by the server</td>
<td><a class="externalLink" href="https://developer.valvesoftware.com/wiki/Server_queries#A2S_RULES">A2S_RULES</a></td>
<td align="left">Yes</td></tr>
<tr class="a">
<td align="left">Challenge</td>
<td>Request a challenge number to be used for challenge based requests.</td>
<td><a class="externalLink" href="https://developer.valvesoftware.com/wiki/Server_queries#A2S_SERVERQUERY_GETCHALLENGE">A2S_SERVERQUERY_GETCHALLENGE</a></td>
<td align="left">No</td></tr>
</tbody>
</table></section><section>
<h4><a name="Supported_Failsafe_Policies"></a>Supported Failsafe Policies</h4>
<p>Below are the list of supported failsafe features available for this module</p>
<table border="0" class="table table-striped">
<thead>

<tr class="a">
<th>Policy</th>
<th>Options Class</th>
<th>Enabled by Default</th>
<th>Description</th></tr>
</thead><tbody>

<tr class="b">
<td align="left">Retry</td>
<td>FailsafeOptions</td>
<td>Yes</td>
<td>A request is re-attempted when a TimeoutException is thrown</td></tr>
<tr class="a">
<td align="left">Rate Limiter</td>
<td>FailsafeOptions</td>
<td>No</td>
<td>Limit the frequency of requests. Useful if the servers you are querying are rate-limited.</td></tr>
</tbody>
</table></section><section>
<h4><a name="Examples"></a>Examples</h4>
<p>Note: Every query returns a response of type <code>SourceQueryResponse</code>. Below are the following information made available to you by the response object:</p>
<table border="0" class="table table-striped">
<thead>

<tr class="a">
<th>Name</th>
<th>Description</th>
<th>Type</th>
<th>Method</th></tr>
</thead><tbody>

<tr class="b">
<td align="left">Address</td>
<td>The address/port of the server</td>
<td>InetSocketAddress</td>
<td>getAddress()</td></tr>
<tr class="a">
<td align="left">Request</td>
<td>The originating request</td>
<td>AbstractRequest</td>
<td>getRequest()</td></tr>
<tr class="b">
<td align="left">Result</td>
<td>The underlying result sent by the server</td>
<td>Object</td>
<td>getResult()</td></tr>
</tbody>
</table><section>
<h5><a name="Non-Blocking_Example"></a>Non-Blocking Example</h5>
<ul>

<li>We use a simple synchronization barrier (CountDownLatch) to allow us to wait unti a response has been received from the server</li>
</ul>

<div class="source"><pre class="prettyprint linenums"><code class="language-java">import java.util.concurrent.CompletableFuture;
import java.util.concurrent.CountDownLatch;

class NonBlockingQueryExample {

    public static void main(String[] args) throws Exception {
        CountDownLatch latch = new CountDownLatch(1);
        //You can use the try with block to automatically close the client after use.
        try (SourceQueryClient client = new SourceQueryClient()) {
            InetSocketAddress address = new InetSocketAddress(&quot;192.168.1.10&quot;, 27015);
            CompletableFuture&lt;SourceQueryInfoResponse&gt; infoFuture = client.getInfo(address);
            if (infoFuture.isDone()) {
                SourceQueryInfoResponse response = infoFuture.getNow(null);
                printResponse(response);
                latch.countDown();
            } else {
                infoFuture.whenComplete((info, error) -&gt; {
                    try {
                        //Check if we received an error
                        if (error != null) {
                            error.printStackTrace(System.err);
                            return;
                        }
                        //Display result
                        printResponse(info);
                    } finally {
                        latch.countDown();
                    }
                });
            }

            //wait till we have received a response
            latch.await();
        }
    }

    private static void printResponse(SourceQueryResponse response) {
        System.out.printf(&quot;Received response from server (Address: %s, Request: %s, Result: %s)%n&quot;, response.getAddress(), response.getRequest(), response.getResult());
    }
}
</code></pre></div></section><section>
<h5><a name="Blocking_Example"></a>Blocking Example</h5>

<div class="source"><pre class="prettyprint linenums"><code class="language-java">class BlockingQueryExample {

    public static void main(String[] args) throws Exception {
        //You can use the try with block to automatically close the client after use.
        try (SourceQueryClient client = new SourceQueryClient()) {
            InetSocketAddress address = new InetSocketAddress(&quot;192.168.1.10&quot;, 27015);
            SourceQueryInfoResponse info = client.getInfo(address).join();
            printResponse(response);
        }
    }

    private static void printResponse(SourceQueryResponse response) {
        System.out.printf(&quot;Received response from server (Address: %s, Request: %s, Result: %s)%n&quot;, response.getAddress(), response.getRequest(), response.getResult());
    }
}

</code></pre></div></section><section>
<h5><a name="Obtaining_a_challenge_number_manually"></a>Obtaining a challenge number manually</h5>
<p>Queries such as <code>getPlayers()</code> and <code>getRules()</code> requires a valid challenge number to be included in your request. Since version <b>1.0.0</b>, the library is now configured to automatically obtain a new challenge number if the server requires it. You can still manually obtain a challenge number by calling <code>SourceQueryClient.getChallenge()</code> then passing its result to one of the overloaded methods provided by this library:</p>
<p>Overloaded methods accepting a non-null challenge integer.</p>
<table border="0" class="table table-striped">
<thead>

<tr class="a">
<th>Query</th>
<th>Method</th></tr>
</thead><tbody>

<tr class="b">
<td align="left">Info</td>
<td>getInfo(InetSocketAddress, Integer)</td></tr>
<tr class="a">
<td align="left">Players</td>
<td>getPlayers(InetSocketAddress, Integer)</td></tr>
<tr class="b">
<td align="left">Rules</td>
<td>getRules(InetSocketAddress, Integer)</td></tr>
</tbody>
</table>
<p><b>Notes</b></p>
<ul>

<li>As of 12/8/2020, valve has <a class="externalLink" href="https://steamcommunity.com/discussions/forum/14/2974028351344359625/">updated</a> A2S_INFO protocol to optionally support challenge based requests. Because of this, some servers might be configured to respond with a challenge request before sending the actual response. The library supports this new change.</li>
<li>In this example, we obtain challenge number with type <code>SourceChallengeType.INFO</code></li>
<li>Passing a non-null challenge integer (regardless if its valid or not) will implicitly disable auto-update. This means that the library will not automatically request for a new challenge number. Instead, it will attempt to send the query, but if the server requires a valid challenge number then a <code>SourceChallengeException</code> will be thrown.</li>
<li>You can obtain the updated challenge number via <code>SourceChallengeException.getChallenge()</code>.</li>
</ul>

<div class="source"><pre class="prettyprint linenums"><code class="language-java">import java.net.InetSocketAddress;
import java.util.concurrent.CompletableFuture;
import java.util.concurrent.CompletionException;
import java.util.concurrent.ExecutionException;

class ManualChallengeNumber {

    public static void main(String[] args) throws Exception {

        try (SourceQueryClient client = new SourceQueryClient()) {
            //First we obtain a challenge number from the server
            InetSocketAddress address = new InetSocketAddress(&quot;192.168.1.10&quot;, 27015);
            CompletableFuture&lt;SourceQueryInfoResponse&gt; infoFuture = queryClient.getChallenge(address, SourceChallengeType.INFO)
                                                                               .thenCompose(challengeResponse -&gt; queryClient.getInfo(challengeResponse.getAddress(), challengeResponse.getResult()));
            if (infoFuture.isDone()) {
                try {
                    SourceQueryInfoResponse response = infoFuture.get();
                    if (response != null) {
                        System.out.printf(&quot;[INFO] Response from '%s' = %s%n&quot;, response.getAddress(), response.getResult());
                    }
                } catch (ExecutionException e) {
                    Throwable cause = e.getCause();
                    if (cause != null) {
                        if (cause instanceof SourceChallengeException) {
                            Integer newChallengeNumber = ((SourceChallengeException) cause).getChallenge();
                            System.err.printf(&quot;Received new challenge number: %d%n&quot;, newChallengeNumber);
                            //TODO: resend request with updated challenge number from 'newChallengeNumber'

                        } else {
                            throw cause;
                        }
                    } else {
                        throw e;
                    }
                }
            } else {
                infoFuture.whenComplete((response, error) -&gt; {
                    if (error != null) {
                        //check if we receive SourceChallengeException
                        error.printStackTrace(System.err);
                        return;
                    }
                    System.out.printf(&quot;[INFO] Response from '%s' = %s%n&quot;, response.getAddress(), response.getResult());
                });
            }
        }

    }
}
</code></pre></div></section><section>
<h5><a name="Rate_limited_queries"></a>Rate limited queries</h5>
<p>Server queries are not rate-limited by default. You will have to explicitly enable it via configuration. You can adjust the rate limit strategy to either <a class="externalLink" href="https://failsafe.dev/rate-limiter/#bursty-rate-limiter">BURST</a> or <a class="externalLink" href="https://failsafe.dev/rate-limiter/#smooth-rate-limiter">SMOOTH</a>.</p>

<div class="source"><pre class="prettyprint linenums"><code class="language-java">import com.ibasco.agql.core.enums.RateLimitType;
import com.ibasco.agql.core.util.FailsafeOptions;
import com.ibasco.agql.protocols.valve.source.query.SourceQueryClient;
import com.ibasco.agql.protocols.valve.source.query.SourceQueryOptions;
import com.ibasco.agql.protocols.valve.source.query.info.SourceQueryInfoResponse;
import com.ibasco.agql.protocols.valve.source.query.info.SourceServer;

import java.net.InetSocketAddress;
import java.util.concurrent.CountDownLatch;
import java.util.concurrent.atomic.AtomicInteger;

public class QueryTest {

   private final CountDownLatch latch = new CountDownLatch(50);

   private final AtomicInteger counter = new AtomicInteger();

   public static void main(String[] args) throws Exception {
      new QueryTest().run();
   }

   private void run() throws Exception {
      //sv_max_queries_sec_global 5           // Maximum queries per second to respond to from anywhere. (Default: 60)
      //sv_max_queries_sec 5                  // Maximum queries per second to respond to from a single IP address. (Default 3.0)
      //sv_max_queries_window 200             // Window over which to average queries per second averages. (Default: 30)
      SourceQueryOptions options = SourceQueryOptions.builder()
                                                     //enable rate limiting
                                                     .option(FailsafeOptions.FAILSAFE_RATELIMIT_ENABLED, true)
                                                     //Select rate limit strategy (BURST or SMOOTH)
                                                     .option(FailsafeOptions.FAILSAFE_RATELIMIT_TYPE, RateLimitType.SMOOTH)
                                                     .option(FailsafeOptions.FAILSAFE_RATELIMIT_PERIOD, 5000L)
                                                     .option(FailsafeOptions.FAILSAFE_RATELIMIT_MAX_EXEC, 10L)
                                                     .option(FailsafeOptions.FAILSAFE_RATELIMIT_MAX_WAIT_TIME, 10000L)
                                                     .option(FailsafeOptions.FAILSAFE_RETRY_ENABLED, false)
                                                     .option(FailsafeOptions.FAILSAFE_RETRY_BACKOFF_ENABLED, false)
                                                     .build();
      InetSocketAddress address = new InetSocketAddress(&quot;192.168.50.6&quot;, 27016);

      //Send 50 requests asynchronously
      try (SourceQueryClient client = new SourceQueryClient(options)) {
         for (int i = 0; i &lt; latch.getCount(); i++) {
            client.getInfo(address).whenComplete(this::printResponse);
         }
         //wait until we have received everything
         System.out.println(&quot;Waiting for all futures to complete&quot;);
         latch.await();
         System.out.println(&quot;Done&quot;);
      }
   }

   private void printResponse(SourceQueryInfoResponse response, Throwable error) {
      try {
         if (error != null) {
            error.printStackTrace(System.err);
            return;
         }
         assert response.getAddress() == response.getResult().getAddress();
         SourceServer info = response.getResult();
         System.out.printf(&quot;[%s] %03d Got response from '%s' = %s (%d/%d)%n&quot;, Thread.currentThread().getName(), counter.incrementAndGet(), response.getAddress(), info.getName(), info.getNumOfPlayers(), info.getMaxPlayers());
      } finally {
         latch.countDown();
      }
   }
}
</code></pre></div>
<p><b>Output:</b></p>
<p>Note: Example program run with with verbose mode enabled <code>-Dagql.verbose=true</code></p>

<div class="source"><pre class="prettyprint linenums"><code class="language-bash">Waiting for all futures to complete
[rate-limiter-3-1] Acquiring send permit for SourceQueryInfoRequest[id=JJCR7ACAKBY] (Max Rate: 500ms)
[rate-limiter-3-1] Acquiring send permit for SourceQueryInfoRequest[id=1XTSSSO57ES] (Max Rate: 500ms)
[agql-el-1-4] 001 Got response from '/192.168.50.6:27016' = Left 4 Dead 2 Dedicated Test Server #00 (0/8)
[rate-limiter-3-1] Acquiring send permit for SourceQueryInfoRequest[id=TBVXMV1GDYY] (Max Rate: 500ms)
[agql-el-1-6] 002 Got response from '/192.168.50.6:27016' = Left 4 Dead 2 Dedicated Test Server #00 (0/8)
[rate-limiter-3-1] Acquiring send permit for SourceQueryInfoRequest[id=VRVECM2ZESA] (Max Rate: 500ms)
[agql-el-1-2] 003 Got response from '/192.168.50.6:27016' = Left 4 Dead 2 Dedicated Test Server #00 (0/8)
[rate-limiter-3-1] Acquiring send permit for SourceQueryInfoRequest[id=ESFDUVNH64] (Max Rate: 500ms)
[agql-el-1-8] 004 Got response from '/192.168.50.6:27016' = Left 4 Dead 2 Dedicated Test Server #00 (0/8)
[rate-limiter-3-1] Acquiring send permit for SourceQueryInfoRequest[id=AXBN4ZETEPO] (Max Rate: 500ms)
[agql-el-1-7] 005 Got response from '/192.168.50.6:27016' = Left 4 Dead 2 Dedicated Test Server #00 (0/8)
[rate-limiter-3-1] Acquiring send permit for SourceQueryInfoRequest[id=1O9ALEVB4SA] (Max Rate: 500ms)
[agql-el-1-5] 006 Got response from '/192.168.50.6:27016' = Left 4 Dead 2 Dedicated Test Server #00 (0/8)
[rate-limiter-3-1] Acquiring send permit for SourceQueryInfoRequest[id=96GLQXS8PVM] (Max Rate: 500ms)
[agql-el-1-9] 007 Got response from '/192.168.50.6:27016' = Left 4 Dead 2 Dedicated Test Server #00 (0/8)
[rate-limiter-3-1] Acquiring send permit for SourceQueryInfoRequest[id=VEWKU75GUWY] (Max Rate: 500ms)
[agql-el-1-1] 008 Got response from '/192.168.50.6:27016' = Left 4 Dead 2 Dedicated Test Server #00 (0/8)
[rate-limiter-3-1] Acquiring send permit for SourceQueryInfoRequest[id=XXMDJU820G] (Max Rate: 500ms)
[agql-el-1-3] 009 Got response from '/192.168.50.6:27016' = Left 4 Dead 2 Dedicated Test Server #00 (0/8)
[rate-limiter-3-1] Acquiring send permit for SourceQueryInfoRequest[id=39MRZEXPS] (Max Rate: 500ms)
[agql-el-1-2] 010 Got response from '/192.168.50.6:27016' = Left 4 Dead 2 Dedicated Test Server #00 (0/8)
[rate-limiter-3-1] Acquiring send permit for SourceQueryInfoRequest[id=PID3KZ3K7I] (Max Rate: 500ms)
[agql-el-1-9] 011 Got response from '/192.168.50.6:27016' = Left 4 Dead 2 Dedicated Test Server #00 (0/8)
[rate-limiter-3-1] Acquiring send permit for SourceQueryInfoRequest[id=DICZIFDPNEM] (Max Rate: 500ms)
[agql-el-1-1] 012 Got response from '/192.168.50.6:27016' = Left 4 Dead 2 Dedicated Test Server #00 (0/8)
[rate-limiter-3-1] Acquiring send permit for SourceQueryInfoRequest[id=2WYFR3L1QAK] (Max Rate: 500ms)
[agql-el-1-7] 013 Got response from '/192.168.50.6:27016' = Left 4 Dead 2 Dedicated Test Server #00 (0/8)
[rate-limiter-3-1] Acquiring send permit for SourceQueryInfoRequest[id=RBL1FAVLOEE] (Max Rate: 500ms)
[agql-el-1-6] 014 Got response from '/192.168.50.6:27016' = Left 4 Dead 2 Dedicated Test Server #00 (0/8)
[rate-limiter-3-1] Acquiring send permit for SourceQueryInfoRequest[id=W7J7NKMGDVI] (Max Rate: 500ms)
[agql-el-1-2] 015 Got response from '/192.168.50.6:27016' = Left 4 Dead 2 Dedicated Test Server #00 (0/8)
[rate-limiter-3-1] Acquiring send permit for SourceQueryInfoRequest[id=UXCBZKCSU] (Max Rate: 500ms)
[agql-el-1-8] 016 Got response from '/192.168.50.6:27016' = Left 4 Dead 2 Dedicated Test Server #00 (0/8)
[rate-limiter-3-1] Acquiring send permit for SourceQueryInfoRequest[id=ZOOHXCROHYG] (Max Rate: 500ms)
[agql-el-1-3] 017 Got response from '/192.168.50.6:27016' = Left 4 Dead 2 Dedicated Test Server #00 (0/8)
[rate-limiter-3-1] Acquiring send permit for SourceQueryInfoRequest[id=TIWTCXYJXJW] (Max Rate: 500ms)
[agql-el-1-1] 018 Got response from '/192.168.50.6:27016' = Left 4 Dead 2 Dedicated Test Server #00 (0/8)
[rate-limiter-3-1] Acquiring send permit for SourceQueryInfoRequest[id=0CQCRMMC70] (Max Rate: 500ms)
[agql-el-1-7] 019 Got response from '/192.168.50.6:27016' = Left 4 Dead 2 Dedicated Test Server #00 (0/8)
[rate-limiter-3-1] Acquiring send permit for SourceQueryInfoRequest[id=SH1OAYGII6O] (Max Rate: 500ms)
[agql-el-1-8] 020 Got response from '/192.168.50.6:27016' = Left 4 Dead 2 Dedicated Test Server #00 (0/8)
[rate-limiter-3-1] Acquiring send permit for SourceQueryInfoRequest[id=YGLKXUVIC0] (Max Rate: 500ms)
[agql-el-1-3] 021 Got response from '/192.168.50.6:27016' = Left 4 Dead 2 Dedicated Test Server #00 (0/8)
[rate-limiter-3-1] Acquiring send permit for SourceQueryInfoRequest[id=2XW4WQMVLI] (Max Rate: 500ms)
[agql-el-1-7] 022 Got response from '/192.168.50.6:27016' = Left 4 Dead 2 Dedicated Test Server #00 (0/8)
[rate-limiter-3-1] Acquiring send permit for SourceQueryInfoRequest[id=WN2UFTWQ9CU] (Max Rate: 500ms)
[agql-el-1-3] 023 Got response from '/192.168.50.6:27016' = Left 4 Dead 2 Dedicated Test Server #00 (0/8)
[rate-limiter-3-1] Acquiring send permit for SourceQueryInfoRequest[id=HLVTI2MSWI0] (Max Rate: 500ms)
[agql-el-1-1] 024 Got response from '/192.168.50.6:27016' = Left 4 Dead 2 Dedicated Test Server #00 (0/8)
[rate-limiter-3-1] Acquiring send permit for SourceQueryInfoRequest[id=HSXSNIHOF3A] (Max Rate: 500ms)
[agql-el-1-5] 025 Got response from '/192.168.50.6:27016' = Left 4 Dead 2 Dedicated Test Server #00 (0/8)
[rate-limiter-3-1] Acquiring send permit for SourceQueryInfoRequest[id=ALEU0HRZMX8] (Max Rate: 500ms)
[agql-el-1-5] 026 Got response from '/192.168.50.6:27016' = Left 4 Dead 2 Dedicated Test Server #00 (0/8)
[rate-limiter-3-1] Acquiring send permit for SourceQueryInfoRequest[id=DREFOEDHHZI] (Max Rate: 500ms)
[agql-el-1-9] 027 Got response from '/192.168.50.6:27016' = Left 4 Dead 2 Dedicated Test Server #00 (0/8)
[rate-limiter-3-1] Acquiring send permit for SourceQueryInfoRequest[id=HRBGSQBRBV0] (Max Rate: 500ms)
[agql-el-1-7] 028 Got response from '/192.168.50.6:27016' = Left 4 Dead 2 Dedicated Test Server #00 (0/8)
[rate-limiter-3-1] Acquiring send permit for SourceQueryInfoRequest[id=HJ4DNVEIE] (Max Rate: 500ms)
[agql-el-1-4] 029 Got response from '/192.168.50.6:27016' = Left 4 Dead 2 Dedicated Test Server #00 (0/8)
[rate-limiter-3-1] Acquiring send permit for SourceQueryInfoRequest[id=TO5LGE9DQGO] (Max Rate: 500ms)
[agql-el-1-5] 030 Got response from '/192.168.50.6:27016' = Left 4 Dead 2 Dedicated Test Server #00 (0/8)
[rate-limiter-3-1] Acquiring send permit for SourceQueryInfoRequest[id=XWRZBZYYGBW] (Max Rate: 500ms)
[agql-el-1-1] 031 Got response from '/192.168.50.6:27016' = Left 4 Dead 2 Dedicated Test Server #00 (0/8)
[rate-limiter-3-1] Acquiring send permit for SourceQueryInfoRequest[id=OULEBW5HJO] (Max Rate: 500ms)
[agql-el-1-2] 032 Got response from '/192.168.50.6:27016' = Left 4 Dead 2 Dedicated Test Server #00 (0/8)
[rate-limiter-3-1] Acquiring send permit for SourceQueryInfoRequest[id=G95DOY15ZS] (Max Rate: 500ms)
[agql-el-1-4] 033 Got response from '/192.168.50.6:27016' = Left 4 Dead 2 Dedicated Test Server #00 (0/8)
[rate-limiter-3-1] Acquiring send permit for SourceQueryInfoRequest[id=SEZS0RA0HLY] (Max Rate: 500ms)
[agql-el-1-2] 034 Got response from '/192.168.50.6:27016' = Left 4 Dead 2 Dedicated Test Server #00 (0/8)
[rate-limiter-3-1] Acquiring send permit for SourceQueryInfoRequest[id=FM52D91TCDQ] (Max Rate: 500ms)
[agql-el-1-3] 035 Got response from '/192.168.50.6:27016' = Left 4 Dead 2 Dedicated Test Server #00 (0/8)
[rate-limiter-3-1] Acquiring send permit for SourceQueryInfoRequest[id=GB4FZFIDIDY] (Max Rate: 500ms)
[agql-el-1-9] 036 Got response from '/192.168.50.6:27016' = Left 4 Dead 2 Dedicated Test Server #00 (0/8)
[rate-limiter-3-1] Acquiring send permit for SourceQueryInfoRequest[id=L0JM3UF03QS] (Max Rate: 500ms)
[agql-el-1-5] 037 Got response from '/192.168.50.6:27016' = Left 4 Dead 2 Dedicated Test Server #00 (0/8)
[rate-limiter-3-1] Acquiring send permit for SourceQueryInfoRequest[id=7ODSFHGL5T0] (Max Rate: 500ms)
[agql-el-1-7] 038 Got response from '/192.168.50.6:27016' = Left 4 Dead 2 Dedicated Test Server #00 (0/8)
[rate-limiter-3-1] Acquiring send permit for SourceQueryInfoRequest[id=FAQUB6AJJGI] (Max Rate: 500ms)
[agql-el-1-9] 039 Got response from '/192.168.50.6:27016' = Left 4 Dead 2 Dedicated Test Server #00 (0/8)
[rate-limiter-3-1] Acquiring send permit for SourceQueryInfoRequest[id=YLTOTQDICEW] (Max Rate: 500ms)
[agql-el-1-6] 040 Got response from '/192.168.50.6:27016' = Left 4 Dead 2 Dedicated Test Server #00 (0/8)
[rate-limiter-3-1] Acquiring send permit for SourceQueryInfoRequest[id=8SJVPUELHOS] (Max Rate: 500ms)
[agql-el-1-2] 041 Got response from '/192.168.50.6:27016' = Left 4 Dead 2 Dedicated Test Server #00 (0/8)
[rate-limiter-3-1] Acquiring send permit for SourceQueryInfoRequest[id=ABREN5XZOVW] (Max Rate: 500ms)
[agql-el-1-8] 042 Got response from '/192.168.50.6:27016' = Left 4 Dead 2 Dedicated Test Server #00 (0/8)
[rate-limiter-3-1] Acquiring send permit for SourceQueryInfoRequest[id=ASM0WPZKYEY] (Max Rate: 500ms)
[agql-el-1-4] 043 Got response from '/192.168.50.6:27016' = Left 4 Dead 2 Dedicated Test Server #00 (0/8)
[rate-limiter-3-1] Acquiring send permit for SourceQueryInfoRequest[id=U9GHFY9OXK] (Max Rate: 500ms)
[agql-el-1-9] 044 Got response from '/192.168.50.6:27016' = Left 4 Dead 2 Dedicated Test Server #00 (0/8)
[rate-limiter-3-1] Acquiring send permit for SourceQueryInfoRequest[id=MTIVSFWHFFI] (Max Rate: 500ms)
[agql-el-1-8] 045 Got response from '/192.168.50.6:27016' = Left 4 Dead 2 Dedicated Test Server #00 (0/8)
[rate-limiter-3-1] Acquiring send permit for SourceQueryInfoRequest[id=LRIEY0SGKUI] (Max Rate: 500ms)
[agql-el-1-6] 046 Got response from '/192.168.50.6:27016' = Left 4 Dead 2 Dedicated Test Server #00 (0/8)
[rate-limiter-3-1] Acquiring send permit for SourceQueryInfoRequest[id=ZC5ENB1VQTU] (Max Rate: 500ms)
[agql-el-1-8] 047 Got response from '/192.168.50.6:27016' = Left 4 Dead 2 Dedicated Test Server #00 (0/8)
[rate-limiter-3-1] Acquiring send permit for SourceQueryInfoRequest[id=DXLSTRP9ITA] (Max Rate: 500ms)
[agql-el-1-6] 048 Got response from '/192.168.50.6:27016' = Left 4 Dead 2 Dedicated Test Server #00 (0/8)
[rate-limiter-3-1] Acquiring send permit for SourceQueryInfoRequest[id=IRSUCUSSGI0] (Max Rate: 500ms)
[agql-el-1-5] 049 Got response from '/192.168.50.6:27016' = Left 4 Dead 2 Dedicated Test Server #00 (0/8)
[agql-el-1-6] 050 Got response from '/192.168.50.6:27016' = Left 4 Dead 2 Dedicated Test Server #00 (0/8)
Done
[main       ] Requested to release resource 'com.ibasco.agql.core.util.AgqlManagedExecutorService@49fc609f' (Subtrahend: 1, Old Ref Count: 1, New Ref Count: 0)
[main       ] Reference count of resource 'com.ibasco.agql.core.util.AgqlManagedExecutorService@49fc609f' has reached 0. Attempting to close
[main       ] Shutting down executor service 'com.ibasco.agql.core.util.AgqlManagedExecutorService@49fc609f' (Reference count: 0)

Process finished with exit code 0
</code></pre></div></section></section></section></section>
        </main>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
<p>Site Chain Logo - By Mdowdell (Own work) [CC BY-SA 3.0 (http://creativecommons.org/licenses/by-sa/3.0)], via Wikimedia Commons</p>
        </div>
      </div>
    </footer>
<script>
	if(anchors) {
	  anchors.add();
	}
</script>
  </body>
</html>
